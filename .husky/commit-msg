#!/usr/bin/env sh

# Color definitions for output formatting
BOLD='\033[1m'
GREEN='\033[0;32m'
YELLOW='\033[0;33m'
RED='\033[0;31m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# Display execution step
echo "${BLUE}${BOLD}üìù Validating commit message format...${NC}"

# Check if in CI environment
if [ -n "$CI" ]; then
  echo "${YELLOW}CI environment detected, performing simplified validation${NC}"
fi

# Extract the commit message for potential display
COMMIT_MSG=$(cat "$1")
COMMIT_MSG_LENGTH=${#COMMIT_MSG}

# Run initial quick validation to catch obvious issues
if [ $COMMIT_MSG_LENGTH -lt 10 ]; then
  echo "${RED}‚ùå Commit message is too short (${COMMIT_MSG_LENGTH} chars)${NC}"
  echo "${YELLOW}A good commit message should describe what changes were made${NC}"
  exit 1
fi

# Display the commit message for visibility
echo "${BLUE}Commit message (${COMMIT_MSG_LENGTH} chars):${NC}"
echo "‚ï≠‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ"
echo "‚îÇ ${YELLOW}${COMMIT_MSG}${NC}"
echo "‚ï∞‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ"

# Run commitlint validation
echo "${BLUE}Running commitlint validation...${NC}"
COMMITLINT_OUTPUT=$(bunx commitlint --color --verbose --edit "$1" 2>&1)
COMMITLINT_STATUS=$?

# Check commitlint result
if [ $COMMITLINT_STATUS -ne 0 ]; then
  echo "${RED}‚ùå Commit message validation failed${NC}"
  echo "$COMMITLINT_OUTPUT"

  # Show examples of valid commit messages
  echo "\n${YELLOW}Examples of valid commit messages:${NC}"
  echo "‚úÖ feat(weather): add temperature unit conversion"
  echo "‚úÖ fix(ui): correct alignment in weather display"
  echo "‚úÖ docs(readme): update installation instructions"
  echo "‚úÖ chore(deps): update dependencies"

  # Show available scopes from commitlint config
  echo "\n${YELLOW}Available scopes:${NC}"
  echo "- docs      (Documentation changes)"
  echo "- config    (Configuration changes)"
  echo "- weather   (Weather-related functionality)"
  echo "- ui        (User interface)"
  echo "- test      (Testing infrastructure)"
  echo "- deps      (Dependencies)"
  echo "- ci        (Continuous integration)"

  echo "\n${YELLOW}For more information on commit conventions:${NC}"
  echo "https://github.com/conventional-changelog/commitlint/#what-is-commitlint"

  exit 1
else
  echo "${GREEN}${BOLD}‚úÖ Commit message format is valid!${NC}"
fi

exit 0
