# Bun Configuration File
# https://bun.sh/docs/runtime/bunfig

# ═══════════════════════════════════════════════════════════════════════════════
# Runtime Configuration
# ═══════════════════════════════════════════════════════════════════════════════

# Preload scripts for all Bun executions
preload = ["./src/weather-update/utils/preload.ts"]

# Log level: "debug" | "warn" | "error"
logLevel = "warn"

# Disable telemetry (optional - respects DO_NOT_TRACK env var)
telemetry = false

# ═══════════════════════════════════════════════════════════════════════════════
# Console Configuration
# ═══════════════════════════════════════════════════════════════════════════════

[console]
# Object inspection depth for console.log()
depth = 4

# ═══════════════════════════════════════════════════════════════════════════════
# Test Configuration
# ═══════════════════════════════════════════════════════════════════════════════

[test]
# Root directory for test discovery
root = "src/tests"

# Preload scripts for test setup
preload = ["./src/tests/setup.ts"]

# Coverage settings
coverage = true
coverageSkipTestFiles = true
coverageThreshold = { line = 0.9, function = 0.9, statement = 0.9 }
coverageReporter = ["text", "lcov"]
coverageDir = "coverage"

# Exclude patterns from coverage
coveragePathIgnorePatterns = [
  "**/*.test.ts",
  "**/*.spec.ts",
  "**/tests/**",
  "**/node_modules/**",
  "**/dist/**",
  "**/coverage/**",
]

# Test execution
randomize = true
seed = 42                    # Reproducible random order for debugging flaky tests
rerunEach = 0                # Set > 0 to catch flaky tests

# Run integration tests concurrently
concurrentTestGlob = "**/integration/**/*.test.ts"

# Reporter configuration (Bun 1.3+)
[test.reporter]
dots = false                 # Compact dot output (set true for CI)
junit = "test-results.xml"   # JUnit XML for CI integration

# ═══════════════════════════════════════════════════════════════════════════════
# Package Manager Configuration
# ═══════════════════════════════════════════════════════════════════════════════

[install]
# Lock exact versions for reproducible builds
exact = true

# Text-based lockfile (bun.lock) - easier to review in PRs
saveTextLockfile = true

# Linker strategy: "hoisted" | "isolated"
# "isolated" is stricter and recommended for new projects
linker = "hoisted"

# Auto-install behavior: "auto" | "force" | "disable" | "fallback"
auto = "fallback"

[install.cache]
# Disable to always resolve fresh versions (useful for CI)
disableManifest = false

[install.lockfile]
save = true

# ═══════════════════════════════════════════════════════════════════════════════
# Run Configuration
# ═══════════════════════════════════════════════════════════════════════════════

[run]
# Use Bun's shell for cross-platform consistency
shell = "bun"

# Auto-alias `node` to `bun` in scripts
bun = true

# Suppress "Running..." output
silent = false

# ═══════════════════════════════════════════════════════════════════════════════
# Environment Variables
# ═══════════════════════════════════════════════════════════════════════════════

[env]
NODE_ENV = "development"
