# Bun Configuration File
# https://bun.sh/docs/runtime/bunfig

# ============================================================
# ðŸ§ª Test Configuration
# ============================================================
[test]
# Test discovery patterns (Bun's default patterns)
# *.test.{js|jsx|ts|tsx}
# *_test.{js|jsx|ts|tsx}
# *.spec.{js|jsx|ts|tsx}
# *_spec.{js|jsx|ts|tsx}

# Root directory for test discovery
root = "src/tests"

# Preload scripts for global test setup
preload = ["./src/tests/setup.ts"]

# Coverage configuration
coverage = true
coverageSkipTestFiles = true  # Exclude test files from coverage

# Coverage thresholds (90% for all metrics)
coverageThreshold = { line = 0.9, function = 0.9, statement = 0.9 }

# Coverage reporters (text for console, lcov for CI)
coverageReporter = ["text", "lcov"]

# Coverage output directory
coverageDir = "coverage"

# Exclude patterns from coverage reports
coveragePathIgnorePatterns = [
  "**/*.test.ts",
  "**/*.spec.ts",
  "**/tests/**",
  "**/node_modules/**",
  "**/dist/**",
  "**/*.config.*",
  "**/coverage/**"
]

# Test execution configuration
randomize = true  # Randomize test order to catch dependencies
rerunEach = 1    # Number of times to rerun each test file

# Timeout configuration (15 seconds for API calls)
timeout = 15000

# Enable concurrent test execution for better performance
# Tests will run concurrently unless marked with .serial

# Enable smol mode for reduced memory usage
smol = false  # Keep false for better performance in CI

# Test file patterns for concurrent execution
# Run integration tests concurrently, unit tests sequentially
concurrentTestGlob = [
  "**/integration/*.test.ts",
  "**/e2e/*.test.ts"
]

# Environment variables for tests
[test.env]
NODE_ENV = "test"
CI = "true"

# ============================================================
# ðŸ“¦ Package Management Configuration
# ============================================================
[install]
# Default registry
registry = "https://registry.npmjs.org"

# Install behavior
production = false  # Include devDependencies by default
dev = true         # Install devDependencies
optional = true    # Install optionalDependencies
peer = true        # Install peerDependencies

# Lockfile configuration
[install.lockfile]
save = true  # Generate bun.lock file
print = "yarn"  # Also generate yarn.lock for compatibility

# Cache configuration
[install.cache]
dir = "~/.bun/install/cache"
disable = false  # Use global cache
disableManifest = false  # Always resolve latest versions

# Global installation directories
globalDir = "~/.bun/install/global"
globalBinDir = "~/.bun/bin"

# ============================================================
# ðŸš€ Runtime Configuration
# ============================================================
# Preload scripts for all Bun executions
preload = ["./src/weather-update/utils/preload.ts"]

# Console configuration
[console]
depth = 3  # Object inspection depth

# Log level
logLevel = "warn"  # "debug" | "warn" | "error"

# ============================================================
# ðŸ”§ Development Configuration
# ============================================================
[run]
# Use Bun for all bun run commands (Node.js compatibility)
bun = true

# Shell configuration
shell = "system"  # Use system shell (not bun shell)

 
