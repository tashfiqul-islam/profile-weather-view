# Lefthook Configuration - Modern Developer Experience 2025
min_version: "2.0.1"

# Clean, minimal output for better UX (2025 standards)
output:
  - execution
  - failure
  - summary

# Pre-commit hooks - Fast parallel execution
pre-commit:
  parallel: true
  commands:
    # Code formatting and linting
    format:
      run: bunx ultracite fix {staged_files}
      stage_fixed: true
      glob: "*.{ts,tsx,js,jsx,json,jsonc,md,mdx,css,scss,toml,yml,yaml}"
      fail_text: "❌ Code formatting issues found. Run 'bun run format' to fix."
    
    # Type checking
    typecheck:
      run: bun run type-check
      glob: "*.{ts,tsx}"
      fail_text: "❌ TypeScript errors found. Fix before committing."
    
    # Run tests for staged files only
    test:
      run: PRETTY_TEST_TITLE="Pre-commit Tests" bun run test:fast
      skip:
        - merge
        - rebase
      fail_text: "❌ Tests failed. Fix issues before committing."

# Commit message validation
commit-msg:
  commands:
    commitlint:
      run: bunx commitlint --edit {1}
      fail_text: "❌ Commit message doesn't follow conventional commits format."

# Interactive commit message builder
prepare-commit-msg:
  commands:
    commitizen:
      interactive: true
      run: bunx commitizen --hook
      env:
        LEFTHOOK: "0"

# Pre-push quality gates
pre-push:
  parallel: true
  commands:
    # Quick type check before push
    typecheck:
      run: bun run type-check
      fail_text: "❌ TypeScript errors found. Fix before pushing."
    
    # Run full test suite before push
    test:
      run: PRETTY_TEST_TITLE="Pre-push Tests" bun run test:fast
      fail_text: "❌ Tests failed. Fix issues before pushing."
